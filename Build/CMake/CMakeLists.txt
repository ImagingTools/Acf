cmake_minimum_required(VERSION 3.26)

message(VERBOSE ${CMAKE_CURRENT_LIST_DIR})

project(Acf)

find_package(QT NAMES Qt6 Qt5 COMPONENTS Core)
find_package("Qt${QT_VERSION_MAJOR}" COMPONENTS Core Widgets Core Gui Xml Network Svg Concurrent REQUIRED)

set(ACFDIR "${CMAKE_CURRENT_LIST_DIR}/../../../Acf")

include("${ACFDIR}/Config/CMake/ProjectRoot.cmake")

set(INCLUDE_DIR "${CMAKE_CURRENT_LIST_DIR}/../../Include")
set(IMPL_DIR "${CMAKE_CURRENT_LIST_DIR}/../../Impl")

set(BUILD_TESTING ON CACHE BOOL "Configures projects for testing")

message(${INCLUDE_DIR})

subdirlist(INCLUDE_DIRS ${INCLUDE_DIR})
subdirlist(IMPL_DIRS ${IMPL_DIR})

get_target_name(TARGETNAME)

if(NOT DEFINED BUILDDIR)
	set(BUILDDIR "${CMAKE_CURRENT_LIST_DIR}/../../../")
endif()

set(AUX_INCLUDE_DIR "${BUILDDIR}/Acf/AuxInclude/${TARGETNAME}/GeneratedFiles")
set(ACFBINDIR "${BUILDDIR}/Acf/Bin/${CMAKE_BUILD_TYPE}_${TARGETNAME}")

include_directories(${AUX_INCLUDE_DIR}/..)

# Include

add_subdirectory("${INCLUDE_DIR}/istd/CMake" "${AUX_INCLUDE_DIR}/istd")
add_subdirectory("${INCLUDE_DIR}/iser/CMake" "${AUX_INCLUDE_DIR}/iser")
add_subdirectory("${INCLUDE_DIR}/ilog/CMake" "${AUX_INCLUDE_DIR}/ilog")
add_subdirectory("${INCLUDE_DIR}/i2d/CMake" "${AUX_INCLUDE_DIR}/i2d")
add_subdirectory("${INCLUDE_DIR}/i3d/CMake" "${AUX_INCLUDE_DIR}/i3d")
#
add_subdirectory("${INCLUDE_DIR}/iattr/CMake" "${AUX_INCLUDE_DIR}/iattr")
add_subdirectory("${INCLUDE_DIR}/iimg/CMake" "${AUX_INCLUDE_DIR}/iimg")
add_subdirectory("${INCLUDE_DIR}/imath/CMake" "${AUX_INCLUDE_DIR}/imath")
add_subdirectory("${INCLUDE_DIR}/icmm/CMake" "${AUX_INCLUDE_DIR}/icmm")
add_subdirectory("${INCLUDE_DIR}/imod/CMake" "${AUX_INCLUDE_DIR}/imod")
add_subdirectory("${INCLUDE_DIR}/icomp/CMake" "${AUX_INCLUDE_DIR}/icomp")

add_subdirectory("${INCLUDE_DIR}/idoc/CMake" "${AUX_INCLUDE_DIR}/idoc")
add_subdirectory("${INCLUDE_DIR}/iprm/CMake" "${AUX_INCLUDE_DIR}/iprm")
add_subdirectory("${INCLUDE_DIR}/ibase/CMake" "${AUX_INCLUDE_DIR}/ibase")
add_subdirectory("${INCLUDE_DIR}/iqt/CMake" "${AUX_INCLUDE_DIR}/iqt")
add_subdirectory("${INCLUDE_DIR}/ifile/CMake" "${AUX_INCLUDE_DIR}/ifile")
add_subdirectory("${INCLUDE_DIR}/iqt2d/CMake" "${AUX_INCLUDE_DIR}/iqt2d")
add_subdirectory("${INCLUDE_DIR}/iview/CMake" "${AUX_INCLUDE_DIR}/iview")
add_subdirectory("${INCLUDE_DIR}/iqtdoc/CMake" "${AUX_INCLUDE_DIR}/iqtdoc")
add_subdirectory("${INCLUDE_DIR}/iwidgets/CMake" "${AUX_INCLUDE_DIR}/iwidgets")
add_subdirectory("${INCLUDE_DIR}/iqtgui/CMake" "${AUX_INCLUDE_DIR}/iqtgui")
add_subdirectory("${INCLUDE_DIR}/ifilegui/CMake" "${AUX_INCLUDE_DIR}/ifilegui")
add_subdirectory("${INCLUDE_DIR}/iloggui/CMake" "${AUX_INCLUDE_DIR}/iloggui")
add_subdirectory("${INCLUDE_DIR}/iqtprm/CMake" "${AUX_INCLUDE_DIR}/iqtprm")
add_subdirectory("${INCLUDE_DIR}/ipackage/CMake" "${AUX_INCLUDE_DIR}/ipackage")

add_subdirectory("${INCLUDE_DIR}/itest/CMake" "${AUX_INCLUDE_DIR}/itest")

# Impl
if(NOT ANDROID)
add_subdirectory("${IMPL_DIR}/BasePck/CMake" "${AUX_INCLUDE_DIR}/BasePck")
add_subdirectory("${IMPL_DIR}/BitmapPck/CMake" "${AUX_INCLUDE_DIR}/BitmapPck")
add_subdirectory("${IMPL_DIR}/QtPck/CMake" "${AUX_INCLUDE_DIR}/QtPck")
add_subdirectory("${IMPL_DIR}/FilePck/CMake" "${AUX_INCLUDE_DIR}/FilePck")
add_subdirectory("${IMPL_DIR}/QtGuiPck/CMake" "${AUX_INCLUDE_DIR}/QtGuiPck")
add_subdirectory("${IMPL_DIR}/QtViewPck/CMake" "${AUX_INCLUDE_DIR}/QtViewPck")
add_subdirectory("${IMPL_DIR}/PackagePck/CMake" "${AUX_INCLUDE_DIR}/PackagePck")
add_subdirectory("${IMPL_DIR}/FileGuiPck/CMake" "${AUX_INCLUDE_DIR}/FileGuiPck")
add_subdirectory("${IMPL_DIR}/ArxcExe/CMake" "${AUX_INCLUDE_DIR}/ArxcExe")
add_subdirectory("${IMPL_DIR}/AcfExe/CMake" "${AUX_INCLUDE_DIR}/AcfExe")
add_dependencies(Acf Arxc)
add_subdirectory("${IMPL_DIR}/AcfLoc/CMake" "${AUX_INCLUDE_DIR}/AcfLoc")
add_dependencies(AcfLoc Acf)
endif()

if (BUILD_TESTING)
	enable_testing()
	add_subdirectory("${INCLUDE_DIR}/ibase/Test/CMake" "${AUX_INCLUDE_DIR}/ibase/Test")
	add_dependencies(ibaseTest ibase)
	add_test(NAME ibaseTest COMMAND ibaseTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/iprm/Test/CMake" "${AUX_INCLUDE_DIR}/iprm/Test")
	add_dependencies(iprmTest iprm)
	add_test(NAME iprmTest COMMAND iprmTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/iser/Test/CMake" "${AUX_INCLUDE_DIR}/iser/Test")
	add_dependencies(iserTest iser)
	add_test(NAME iserTest COMMAND iserTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/ifile/Test/CMake" "${AUX_INCLUDE_DIR}/ifile/Test")
	add_dependencies(ifileTest ifile)
	add_test(NAME ifileTest COMMAND ifileTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/icmm/Test/CMake" "${AUX_INCLUDE_DIR}/icmm/Test")
	add_dependencies(icmmTest icmm iser)
	add_test(NAME icmmTest COMMAND icmmTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/iimg/Test/CMake" "${AUX_INCLUDE_DIR}/iimg/Test")
	add_dependencies(iimgTest iimg icmm i2d imath ibase imod iser istd iprm idoc)
	add_test(NAME iimgTest COMMAND iimgTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/i2d/Test/CMake" "${AUX_INCLUDE_DIR}/i2d/Test")
	add_dependencies(i2dTest i2d imath istd iser)
	add_test(NAME i2dTest COMMAND i2dTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/i3d/Test/CMake" "${AUX_INCLUDE_DIR}/i3d/Test")
	add_dependencies(i3dTest i3d i2d imath istd iser)
	add_test(NAME i3dTest COMMAND i3dTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/imath/Test/CMake" "${AUX_INCLUDE_DIR}/imath/Test")
	add_dependencies(imathTest imath istd)
	add_test(NAME imathTest COMMAND imathTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/icomp/Test/CMake" "${AUX_INCLUDE_DIR}/icomp/Test")
	add_dependencies(icompTest icomp ifile ilog iser imod istd)
	add_test(NAME icompTest COMMAND icompTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/ipackage/Test/CMake" "${AUX_INCLUDE_DIR}/ipackage/Test")
	add_dependencies(ipackageTest ipackage icomp ifile ilog iser imod istd BasePck FilePck PackagePck)
	add_test(NAME ipackageTest COMMAND ipackageTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("${INCLUDE_DIR}/istd/Test/CMake" "${AUX_INCLUDE_DIR}/istd/Test")
	add_dependencies(istdTest istd)
	add_test(NAME istdTest COMMAND istdTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/SelectionParamIntegrationTest/CMake" "${AUX_INCLUDE_DIR}/Tests/SelectionParamIntegrationTest")
	add_dependencies(SelectionParamIntegrationTest Arxc iprm iser itest)
	add_test(NAME SelectionParamIntegrationTest COMMAND SelectionParamIntegrationTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/ParamsManagerTest/CMake" "${AUX_INCLUDE_DIR}/Tests/ParamsManagerTest")
	add_dependencies(ParamsManagerTest Arxc iprm iser itest)
	add_test(NAME ParamsManagerTest COMMAND ParamsManagerTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/SelectionParamComponentTest/CMake" "${AUX_INCLUDE_DIR}/Tests/SelectionParamComponentTest")
	add_dependencies(SelectionParamComponentTest Arxc iprm iser itest)
	add_test(NAME SelectionParamComponentTest COMMAND SelectionParamComponentTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/LogTest/CMake" "${AUX_INCLUDE_DIR}/Tests/LogTest")
	add_dependencies(LogTest Arxc ilog iser itest)
	add_test(NAME LogTest COMMAND LogTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/DocumentManagementComponentTest/CMake" "${AUX_INCLUDE_DIR}/Tests/DocumentManagementComponentTest")
	add_dependencies(DocumentManagementComponentTest Arxc idoc iser itest)
	add_test(NAME DocumentManagementComponentTest COMMAND DocumentManagementComponentTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/IqtComponentTest/CMake" "${AUX_INCLUDE_DIR}/Tests/IqtComponentTest")
	add_dependencies(IqtComponentTest Arxc iqt ifile iprm iser itest)
	add_test(NAME IqtComponentTest COMMAND IqtComponentTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/MultiThreadingComponentTest/CMake" "${AUX_INCLUDE_DIR}/Tests/MultiThreadingComponentTest")
	add_dependencies(MultiThreadingComponentTest Arxc iprm iser itest)
	add_test(NAME MultiThreadingComponentTest COMMAND MultiThreadingComponentTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/AutoPersistenceTest/CMake" "${AUX_INCLUDE_DIR}/Tests/AutoPersistenceTest")
	add_dependencies(AutoPersistenceTest Arxc iprm ifile iser itest)
	add_test(NAME AutoPersistenceTest COMMAND AutoPersistenceTest WORKING_DIRECTORY "${ACFBINDIR}")
	add_subdirectory("../../Tests/VarIndexTest/CMake" "${AUX_INCLUDE_DIR}/Tests/VarIndexTest")
	add_dependencies(VarIndexTest istd itest)
	add_test(NAME VarIndexTest COMMAND VarIndexTest WORKING_DIRECTORY "${ACFBINDIR}")
	# Impl Tests (GUI tests, build only for desktop platforms)
	if(NOT ANDROID)
		add_subdirectory("../../Tests/TestComposedGui/CMake" "${AUX_INCLUDE_DIR}/Tests/TestComposedGui")
		add_dependencies(TestComposedGui Arxc Acf AcfLoc icomp iwidgets)
	endif()
endif()
